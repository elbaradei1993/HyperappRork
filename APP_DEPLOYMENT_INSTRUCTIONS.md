# Pulse App - APK and iOS Deployment Instructions

## Prerequisites

1. **Install EAS CLI globally:**
   ```bash
   npm install -g eas-cli
   ```

2. **Create an Expo account:**
   - Go to https://expo.dev and sign up
   - Verify your email

3. **For iOS deployment:**
   - Apple Developer Account ($99/year)
   - Xcode installed on macOS

4. **For Android deployment:**
   - Google Play Console account ($25 one-time fee)
   - Android Studio (optional, for testing)

## Setup Steps

### 1. Replace Configuration Files

Copy the production configuration files:
```bash
# Backup current files
cp app.json app.development.json
cp package.json package.development.json

# Use production configs
cp app.production.json app.json
cp package.production.json package.json
```

### 2. Configure Environment Variables

Create a `.env.production` file:
```env
EXPO_PUBLIC_SUPABASE_URL=your_supabase_url
EXPO_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 3. Initialize EAS

```bash
# Login to Expo
eas login

# Initialize EAS in your project
eas init

# This will create an EAS project ID
# Update app.production.json with the generated projectId
```

### 4. Create EAS Configuration

Create `eas.json` file:
```json
{
  "cli": {
    "version": ">= 5.0.0",
    "appVersionSource": "local"
  },
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal",
      "ios": {
        "resourceClass": "m-medium"
      }
    },
    "preview": {
      "distribution": "internal",
      "ios": {
        "resourceClass": "m-medium"
      },
      "android": {
        "buildType": "apk"
      }
    },
    "production": {
      "ios": {
        "resourceClass": "m-medium"
      },
      "android": {
        "buildType": "app-bundle"
      },
      "env": {
        "EXPO_PUBLIC_SUPABASE_URL": "YOUR_SUPABASE_URL",
        "EXPO_PUBLIC_SUPABASE_ANON_KEY": "YOUR_SUPABASE_ANON_KEY"
      }
    }
  },
  "submit": {
    "production": {
      "ios": {
        "appleId": "your@email.com",
        "ascAppId": "YOUR_APP_STORE_CONNECT_APP_ID",
        "appleTeamId": "YOUR_TEAM_ID"
      },
      "android": {
        "serviceAccountKeyPath": "./google-play-service-account.json",
        "track": "production"
      }
    }
  }
}
```

## Building the App

### For Android APK (Testing)

```bash
# Build APK for testing
eas build --platform android --profile preview

# This will generate an APK file you can install directly
```

### For Android Production (Google Play)

```bash
# Build AAB for Google Play Store
eas build --platform android --profile production

# Submit to Google Play
eas submit --platform android --profile production
```

### For iOS (TestFlight/App Store)

```bash
# Build for iOS
eas build --platform ios --profile production

# Submit to App Store Connect
eas submit --platform ios --profile production
```

## Important Configuration Updates

### 1. Update Bundle Identifiers
- iOS: Change `com.pulse.safety` in app.json to your unique identifier
- Android: Change `com.pulse.safety` in app.json to your unique package name

### 2. App Icons and Splash Screens
Ensure these files exist with correct dimensions:
- `assets/images/icon.png` - 1024x1024px (iOS and Android app icon)
- `assets/images/adaptive-icon.png` - 1024x1024px (Android adaptive icon)
- `assets/images/splash-icon.png` - 1284x2778px (splash screen)

### 3. Push Notifications Setup

#### iOS:
1. Enable Push Notifications in Apple Developer Console
2. Create Push Notification certificate
3. Upload to Expo dashboard

#### Android:
1. Set up Firebase project
2. Download `google-services.json`
3. Place in project root

### 4. Required Certificates

#### iOS:
- Distribution certificate
- Provisioning profile
- Push notification certificate

#### Android:
- Upload key (generated by EAS)
- Google Play service account key (for automated submission)

## Testing Before Deployment

### Local Testing
```bash
# Run on iOS Simulator
npm run ios

# Run on Android Emulator
npm run android

# Test production build locally
npx expo start --no-dev --minify
```

### Device Testing
1. Build development client:
   ```bash
   eas build --platform all --profile development
   ```
2. Install on physical devices
3. Test all features, especially:
   - Location services
   - Push notifications
   - Camera/microphone
   - Background location updates

## Pre-submission Checklist

- [ ] Test on real devices (iOS and Android)
- [ ] Verify all permissions work correctly
- [ ] Test offline functionality
- [ ] Check crash reporting
- [ ] Verify deep linking works
- [ ] Test push notifications
- [ ] Review app store guidelines compliance
- [ ] Prepare app store listings (screenshots, descriptions)
- [ ] Set up privacy policy and terms of service URLs
- [ ] Configure app store metadata

## Troubleshooting

### Common Issues:

1. **Build fails with "Bundle identifier already exists"**
   - Change the bundle identifier in app.json to something unique

2. **iOS build fails with provisioning profile error**
   - Ensure you have a valid Apple Developer account
   - Let EAS handle certificate generation automatically

3. **Android build fails with package name error**
   - Ensure package name follows format: com.company.appname
   - Must be unique on Google Play

4. **Push notifications not working**
   - Verify Firebase/APNs setup
   - Check notification permissions in app

## Support Resources

- [Expo Documentation](https://docs.expo.dev)
- [EAS Build](https://docs.expo.dev/build/introduction/)
- [App Store Guidelines](https://developer.apple.com/app-store/review/guidelines/)
- [Google Play Guidelines](https://play.google.com/console/about/guides/)
